version: "3"
volumes:
  postgresqldata:
  mysqldata:
  media:
  proxy-certs:
  proxy-vhost.d:
  proxy-html:
services:

  # NGINX PROXY
  nginx-proxy:
    image: jwilder/nginx-proxy
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - proxy-certs:/etc/nginx/certs:ro
      - proxy-vhost.d:/etc/nginx/vhost.d
      - proxy-html:/usr/share/nginx/html
    ports: 
      - 80:80
      - 443:443

  # LETS ENCRYPT
  lets-encrypt:
    image: jrcs/letsencrypt-nginx-proxy-companion
    environment:
      - NGINX_PROXY_CONTAINER=nginx-proxy
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - proxy-certs:/etc/nginx/certs:rw
      - proxy-vhost.d:/etc/nginx/vhost.d
      - proxy-html:/usr/share/nginx/html

  # PROFESSIONAL SITE
  professional-site:
    image: jteppinette/professional-site
    environment:
      - VIRTUAL_HOST=jteppinette.com,home.jteppinette.com
      - LETSENCRYPT_HOST=jteppinette.com,home.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com

  # POSTGRESQL
  postgresql:
    image: postgres:9.6.2
    env_file: .env
    environment:
      - POSTGRES_USER=db
    volumes:
      - postgresqldata:/var/lib/postgresql/data

  # MYSQL
  mysql:
    image: mysql
    env_file: .env
    environment:
      - MYSQL_USER=db
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
    volumes:
      - mysqldata:/var/lib/mysql

  # GO JSON API SEED
  go-json-api-seed:
    image: jteppinette/go-json-api-seed
    env_file: .env
    environment:
      - VIRTUAL_HOST=go-json-api-seed.jteppinette.com
      - LETSENCRYPT_HOST=go-json-api-seed.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com
      - DB_NAME=gojsonapiseed
      - DB_PORT=5432
    links:
      - postgresql:db

  # AMP
  amp:
    image: jteppinette/amp
    env_file: .env
    environment:
      - VIRTUAL_HOST=amp.jteppinette.com
      - LETSENCRYPT_HOST=amp.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com
      - APP_URL=amp.jteppinette.com
      - DB_NAME=amp
      - DB_PORT=3306
    links:
      - mysql:db
    volumes:
      - media:/app/media

  # DJANGO API SEED
  django-api-seed:
    image: jteppinette/django-api-seed
    env_file: .env
    environment:
      - VIRTUAL_HOST=django-api-seed.jteppinette.com
      - LETSENCRYPT_HOST=django-api-seed.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com
      - DB_NAME=djangoapiseed
      - DB_PORT=3306
    links:
      - mysql:db

  angular-seed:
    image: jteppinette/angular-seed
    environment:
      - VIRTUAL_HOST=angular-seed.jteppinette.com
    links:
      - django-api-seed:upstream

  # RISK MANAGED
  risk-managed:
    image: jteppinette/risk-managed
    env_file: .env
    environment:
      - VIRTUAL_HOST=risk-managed.jteppinette.com
      - LETSENCRYPT_HOST=risk-managed.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com
      - DB_NAME=riskmanaged
      - DB_PORT=3306
    links:
      - mysql:db
    volumes:
      - media:/app/media

  # WATER DRAGON
  water-dragon-api:
    image: jteppinette/water-dragon-api
    env_file: .env
    environment:
      - VIRTUAL_HOST=api.water-dragon.jteppinette.com
      - LETSENCRYPT_HOST=api.water-dragon.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com
      - DB_NAME=waterdragon
      - DB_PORT=3306
    links:
      - mysql:db
    volumes:
      - media:/app/media

  # PERAGRIN
  peragrin-client:
    image: jteppinette/peragrin-client
    environment:
      - VIRTUAL_HOST=app.peragrin.jteppinette.com
      - LETSENCRYPT_HOST=app.peragrin.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com
    links:
      - peragrin-api:upstream

  peragrin-api:
    image: jteppinette/peragrin-api
    env_file: .env
    environment:
      - VIRTUAL_HOST=api.peragrin.jteppinette.com
      - LETSENCRYPT_HOST=api.peragrin.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com
      - DB_NAME=peragrin
      - DB_PORT=3306
    links:
      - mysql:db

  peragrin-home:
    image: jteppinette/peragrin-home
    environment:
      - VIRTUAL_HOST=peragrin.jteppinette.com
      - LETSENCRYPT_HOST=peragrin.jteppinette.com
      - LETSENCRYPT_EMAIL=josheppinette@icloud.com
